# LP側への共有資料一覧

**作成日**: 2025年1月  
**最終更新**: 2025年1月

---

## 📋 概要

このドキュメントは、LP側の実装に必要な資料をまとめたものです。

**重要**: 以下の資料をLP側の開発チームに共有してください。

---

## 📚 必須資料（優先順位順）

### 1. **`LP-SHARED-INFO.md`** ⭐ 最重要
**目的**: クイックリファレンス、最新の変更点、実装チェックリスト

**内容**:
- CMS側の実装完了事項
- 重要な変更点（エラーレスポンス形式の統一など）
- LP側の実装チェックリスト
- APIエンドポイント
- リクエスト/レスポンス例

**推奨**: 最初にこの資料を確認してください。

---

### 2. **`PUBLIC-PAGE-URL-GENERATION.md`** ⭐ 新規実装必須
**目的**: URL取得とメール送信の実装ガイド

**内容**:
- 公開ページURLとログインURLの取得方法
- ポーリング実装の詳細
- メール送信の実装例
- APIエンドポイント仕様
- エラーハンドリング

**重要**: この資料に基づいて、**URL取得のポーリング処理**と**メール送信処理**を実装してください。

**実装が必要な機能**:
- ✅ `/api/claim/{requestId}/urls` APIの呼び出し（ポーリング）
- ✅ 取得したURLを使用したメール送信

### 2-1. **`URL_GENERATION_TIMING.md`** ⭐ URL確定のタイミングを理解するために必須
**目的**: URLがいつ確定するか、LP側がいつ取得できるかを明確にする

**内容**:
- URL確定の完全フロー
- タイミングの詳細
- エラーハンドリング
- LP側実装の推奨フロー

**重要**: URL確定のタイミングを理解するために、この資料を必ず確認してください。

---

### 3. **`LP-API-integration.md`** ⭐ 詳細仕様
**目的**: API連携の詳細仕様書

**内容**:
- `/api/lp-form`エンドポイントの詳細仕様
- リクエスト/レスポンスの完全な定義
- エラーハンドリング
- セキュリティ要件
- JWTトークンの生成方法

**推奨**: 実装時に詳細を確認する際に参照してください。

---

## 📖 参考資料（任意）

### 4. **`ACCOUNT-CREATION-FLOW.md`**
**目的**: アカウント作成からURL確定までの完全なフロー

**内容**:
- ステップバイステップのフロー
- 各ステップの担当者とタイミング
- 確認ポイント
- エラーハンドリング

**用途**: CRM構築時や、フロー全体を理解する際に参照してください。

---

## 🎯 実装の優先順位

### フェーズ1: 既存機能の確認（既に実装済みの可能性）
1. ✅ LPフォーム送信時のAPI連携（`/api/lp-form`）
2. ✅ JWTトークンの生成
3. ✅ 認証リンクの生成
4. ✅ メール送信（認証リンクを含む）

### フェーズ2: 新規実装が必要な機能 ⭐
1. **URL取得のポーリング処理**
   - `GET /api/claim/{requestId}/urls` APIを定期的に呼び出す
   - 最大30回、5秒間隔でポーリング
   - URLが取得できたらメール送信

2. **URL通知メールの送信**
   - 取得した`publicPageUrl`と`loginUrl`を含むメールを送信
   - メール内容はLP側でカスタマイズ可能

---

## 📝 実装チェックリスト（LP側）

### 既存機能の確認
- [ ] LPフォーム送信時のAPI連携が正常に動作しているか
- [ ] JWTトークンの生成が正しく実装されているか
- [ ] 認証リンクの生成が正しい形式か（`/claim?k={JWT}`）
- [ ] 認証リンクを含むメール送信が正常に動作しているか

### 新規実装が必要な機能
- [ ] `/api/claim/{requestId}/urls` APIの呼び出し処理
- [ ] ポーリング処理（最大30回、5秒間隔）
- [ ] URL取得成功時のメール送信処理
- [ ] エラーハンドリング（タイムアウト、APIエラーなど）

---

## 🔗 APIエンドポイント一覧

### 1. LPフォーム送信（既存）
```
POST https://emolink-cms.web.app/api/lp-form
```
**資料**: `LP-API-integration.md`

### 2. URL取得（新規実装が必要）⭐
```
GET https://asia-northeast1-memorylink-cms.cloudfunctions.net/apiV2/api/claim/{requestId}/urls
```
**資料**: `PUBLIC-PAGE-URL-GENERATION.md`

**注意**: このAPIはFirebase Functionsとして実装されます。実装完了後、LP側でポーリング処理を実装してください。

---

## ⚠️ 重要な注意事項

### 1. 認証リンクの形式
- ✅ **正しい**: `/claim?k={JWTトークン}`
- ❌ **間違い**: `/claim?sk={秘密鍵}`

JWT方式（`k`パラメータ）を使用してください。

### 2. エラーレスポンスの形式
すべてのエラーレスポンスは以下の形式です：
```json
{
  "ok": false,
  "error": "エラーメッセージ"
}
```

`result.ok === false`でエラーを判定してください。

### 3. URL取得のタイミング
- 認証リンク送信後、定期的にポーリングを開始
- 認証成功後、数秒以内にURLが利用可能になります
- 最大30回（約2.5分）までポーリングを継続

### 4. メール送信のタイミング
- URL取得成功後、即座にメール送信
- メール内容はLP側で自由にカスタマイズ可能

---

## 📞 サポート

実装に関する質問や問題がある場合は、CMS開発チームまでお問い合わせください。

---

## 📋 資料のダウンロード

以下の資料をLP側の開発チームに共有してください：

1. **`LP-SHARED-INFO.md`** - クイックリファレンス
2. **`PUBLIC-PAGE-URL-GENERATION.md`** - URL取得とメール送信の実装ガイド ⭐
3. **`LP-API-integration.md`** - API連携の詳細仕様
4. **`ACCOUNT-CREATION-FLOW.md`** - 完全なフロー（参考用）

---

**最終更新日**: 2025年1月  
**バージョン**: 1.0

