# Vercelログ確認ガイド

## 📋 概要

このドキュメントでは、VercelダッシュボードでLPフォームAPI（`/api/lp-form`）のログを確認する方法を説明します。

## 🔍 Vercelダッシュボードでのログ確認方法

### 方法1: Functionsタブから確認（推奨）

1. **Vercelダッシュボードにアクセス**
   - https://vercel.com/dashboard にアクセス
   - ログイン（必要に応じて）

2. **プロジェクトを選択**
   - ダッシュボードから対象のプロジェクト（例: `emolink-cms`）をクリック

3. **Functionsタブを開く**
   - プロジェクトページの上部メニューから「**Functions**」タブをクリック
   - または、左サイドバーから「**Functions**」を選択

4. **APIルートを確認**
   - Functions一覧から「**api/lp-form**」を探す
   - クリックして詳細を表示

5. **ログを確認**
   - 「**Logs**」タブまたは「**Runtime Logs**」をクリック
   - エラーメッセージや実行ログを確認

### 方法2: Deploymentsタブから確認

1. **Deploymentsタブを開く**
   - プロジェクトページの「**Deployments**」タブをクリック

2. **最新のデプロイメントを選択**
   - 最新のデプロイメントをクリック

3. **Functionsを確認**
   - デプロイメント詳細ページで「**Functions**」セクションを確認
   - 「**api/lp-form**」をクリック

4. **ログを確認**
   - 「**Logs**」タブでログを確認

### 方法3: リアルタイムログの確認

1. **プロジェクトページを開く**
   - Vercelダッシュボードでプロジェクトを選択

2. **「Logs」タブを開く**
   - プロジェクトページの上部メニューから「**Logs**」タブをクリック
   - または、左サイドバーから「**Logs**」を選択

3. **フィルタリング**
   - 検索バーに「`api/lp-form`」と入力
   - または、関数名でフィルタリング

4. **ログを確認**
   - リアルタイムでログが表示されます
   - エラーメッセージを確認

## 📊 確認すべきログ項目

### 1. エラーメッセージ
```
Error: Missing or insufficient permissions
Error: PERMISSION_DENIED
Error: fetch failed
```

### 2. 実行ログ
```
LP form error: [エラー内容]
reCAPTCHA verification error: [エラー内容]
```

### 3. ステータスコード
- `200`: 成功
- `400`: バリデーションエラー
- `403`: 認証エラー
- `500`: サーバーエラー

## 🔧 Vercel CLIでのログ確認（代替方法）

Vercel CLIがインストールされている場合、コマンドラインからもログを確認できます。

### インストール（未インストールの場合）
```bash
npm i -g vercel
```

### ログイン
```bash
vercel login
```

### ログの確認
```bash
# プロジェクトのログを確認
vercel logs

# 特定の関数のログを確認
vercel logs --function api/lp-form

# リアルタイムでログを確認
vercel logs --follow
```

## 📝 ログ確認時のチェックポイント

### 1. エラーメッセージの確認
- [ ] エラーメッセージが表示されているか
- [ ] エラーの種類（認証エラー、権限エラー、ネットワークエラーなど）
- [ ] エラーが発生したタイミング

### 2. リクエスト情報の確認
- [ ] リクエストの送信元（Origin）
- [ ] リクエストボディの内容
- [ ] リクエストヘッダー

### 3. レスポンス情報の確認
- [ ] ステータスコード
- [ ] レスポンスボディ
- [ ] エラーメッセージ

## 🎯 よくあるエラーパターン

### パターン1: 認証エラー
```
Error: Missing or insufficient permissions
```
**原因**: Firestoreルールで認証が必要だが、リクエストが認証されていない  
**対処**: Firebase Admin SDKを使用する

### パターン2: 権限エラー
```
Error: PERMISSION_DENIED
```
**原因**: Firestoreルールで書き込みが拒否されている  
**対処**: Firebase Admin SDKを使用する、またはルールを修正

### パターン3: ネットワークエラー
```
Error: fetch failed
```
**原因**: ネットワーク接続の問題  
**対処**: ネットワーク設定を確認

## 📸 スクリーンショットの取得

ログ確認時に、以下のスクリーンショットを取得しておくと便利です：

1. **エラーメッセージの全体**
2. **リクエスト情報**
3. **レスポンス情報**
4. **タイムスタンプ**

## 🔗 関連リンク

- [Vercelダッシュボード](https://vercel.com/dashboard)
- [Vercel Functions ドキュメント](https://vercel.com/docs/functions)
- [Vercel Logs ドキュメント](https://vercel.com/docs/observability/logs)

## 📝 メモ

- ログは一定期間後に削除される可能性があります
- 重要なログはスクリーンショットやコピーで保存しておくことを推奨します
- リアルタイムログは最新のデプロイメントでのみ確認できます

---

*作成日時: 2025年1月*

